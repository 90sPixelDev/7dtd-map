!function(e){var t={};function n(o){if(t[o])return t[o].exports;var a=t[o]={i:o,l:!1,exports:{}};return e[o].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(o,a,function(t){return e[t]}.bind(null,a));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t){function n(){const e=document.getElementById("cood_we"),t=document.getElementById("cood_ns"),n=document.getElementById("download"),o=document.getElementById("show_biomes"),a=document.getElementById("biomes"),r=document.getElementById("show_splat3"),d=document.getElementById("splat3"),l=document.getElementById("show_radiation"),s=document.getElementById("radiation"),i=document.getElementById("show_prefabs"),c=document.getElementById("prefabs"),u=document.getElementById("scale"),m=document.getElementById("sign_size"),f=document.getElementById("brightness"),p=document.getElementById("prefabs_filter"),g=document.getElementById("prefabs_filter_presets"),y=document.getElementById("prefabs_num"),v=document.getElementById("prefabs_list"),E=document.getElementById("map");let h,b,w,x=0,L=0,I=[],B=[];function _(){const e=u.value;x=Math.max(h?h.width:0,b?b.width:0),L=Math.max(h?h.height:0,b?b.height:0),E.width=x*e,E.height=L*e,function(){0===I.length?y.textContent="No prefabs":0===p.value.trim().length?y.textContent="All prefabs":y.textContent=`Hit ${B.length} prefabs`;const e=document.createElement("ul");B.forEach(t=>{const n=document.createElement("li");n.textContent=`${t.name} (${t.x}, ${t.y})`,e.appendChild(n)}),v.replaceChild(e,v.firstChild)}();const t=E.getContext("2d");t.scale(e,e),t.filter=`brightness(${f.value}%)`,h&&o.checked&&t.drawImage(h,0,0,x,L),b&&r.checked&&t.drawImage(b,0,0,x,L),w&&l.checked&&(t.filter="url(#rad_filter)",t.imageSmoothingEnabled=!1,t.drawImage(w,0,0,x,L),t.imageSmoothingEnabled=!0),t.filter="none",i.checked&&function(e){const t=m.value;e.font=`${t}px sans-serif`,e.lineWidth=Math.round(.08*t),e.strokeStyle="white",e.fillStyle="red",e.textAlign="center",e.textBaseline="middle",e.shadowColor="black";const n=x/2,o=L/2;B.forEach(t=>{const a=n+t.x,r=o-t.y;e.shadowBlur=20,e.strokeText(C,a,r),e.shadowBlur=0,e.fillText(C,a,r)})}(t),console.log("update")}_();const C="âœ—";async function S(e){"biomes.png"===e.name?(console.log("Load biome"),"image/png"!==e.type&&console.warn("Unexpected biomes.png file type: %s",e.type),h=await k(e),a.value=""):"splat3.png"===e.name?(console.log("Load splat3"),"image/png"!==e.type&&console.warn("Unexpected splat3.png file type: %s",e.type),b=await k(e),d.value=""):"radiation.png"===e.name?(console.log("Load radiation"),"image/png"!==e.type&&console.warn("Unexpected splat3.png file type: %s",e.type),w=await k(e),s.value=""):"prefabs.xml"===e.name?(console.log("Update prefab list"),"text/xml"!==e.type&&console.warn("Unexpected prefabs.xml file type: %s",e.type),await A(e),M(),d.value=""):console.warn("Unknown file: %s, %s",e.name,e.type)}async function T(e){return 0===e.files.length?(console.log("No file"),null):k(e.files[0])}async function k(e){return async function(e){return new Promise((t,n)=>{const o=new Image;o.addEventListener("load",()=>t(o)),o.addEventListener("error",n),o.src=e})}(await async function(e){return new Promise((t,n)=>{const o=new FileReader;o.onerror=n,o.onload=(()=>t(o.result)),o.readAsDataURL(e)})}(e))}async function A(e){const t=await async function(e){return new Promise((t,n)=>{const o=new FileReader;o.onerror=n,o.onload=(()=>t(o.result)),o.readAsText(e)})}(e);if(!t)return;const n=(new DOMParser).parseFromString(t,"text/xml");I=Array.from(n.getElementsByTagName("decoration")).map(e=>{const t=e.getAttribute("position").split(",");return{name:e.getAttribute("name"),x:parseInt(t[0],10),y:parseInt(t[2],10)}})}function M(){const e=p.value.trim();return(B=e?I.filter(t=>t.name.includes(e)):I).sort((e,t)=>e.name>t.name?1:e.name<t.name?-1:0),B}n.addEventListener("click",()=>{const e=document.createElement("a");e.href=E.toDataURL("image/png");const t=p.value?`-${p.value}`:"";e.download=`7DtD-renderer${t}.png`,e.click()}),a.addEventListener("input",async()=>{console.log("Load biome");const e=await T(a);e&&(h=e),_()}),d.addEventListener("input",async()=>{console.log("Load splat3");const e=await T(d);e&&(b=e),_()}),s.addEventListener("input",async()=>{console.log("Load radiation");const e=await T(s);e&&(w=e),_()}),c.addEventListener("input",async()=>{console.log("Load prefabs"),await async function(){if(0===c.files.length)return console.log("No file"),void(I=[]);await A(c.files[0])}(),M(),_()}),p.addEventListener("input",()=>{console.log("Update prefab list"),M(),_()}),[o,r,l,i,m,f].forEach(e=>{e.addEventListener("input",_)}),u.addEventListener("change",_),document.addEventListener("dragenter",e=>{e.dataTransfer.types.includes("Files")&&(e.preventDefault(),document.body.classList.add("dragovered"))}),document.addEventListener("dragover",e=>{e.dataTransfer.types.includes("Files")&&(e.preventDefault(),e.dataTransfer.dropEffect="copy",document.body.classList.add("dragovered"))}),document.addEventListener("dragleave",e=>{0===e.clientX&&0===e.clientY&&(e.preventDefault(),document.body.classList.remove("dragovered"))}),document.addEventListener("drop",async e=>{e.dataTransfer.types.includes("Files")&&(e.preventDefault(),document.body.classList.remove("dragovered"),await Promise.all(Array.from(e.dataTransfer.files).map(S)),_())}),Array.from(document.querySelectorAll("[data-source-input")).forEach(e=>{const t=document.querySelector(`#${e.dataset.sourceInput}`);e.textContent=t.value,t.addEventListener("input",()=>{e.textContent=t.value})}),E.addEventListener("mousemove",n=>{e.textContent=-Math.round((.5-n.offsetX/E.width)*x),t.textContent=Math.round((.5-n.offsetY/E.height)*L)}),E.addEventListener("mouseout",()=>{e.textContent="-",t.textContent="-"}),Array.from(g.getElementsByTagName("button")).forEach(e=>{e.addEventListener("click",()=>{p.value=e.dataset.filter||e.textContent,M(),_()})})}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",n):n()}]);