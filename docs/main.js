!function(e){function t(t){for(var n,r,a=t[0],i=t[1],o=0,d=[];o<a.length;o++)r=a[o],s[r]&&d.push(s[r][0]),s[r]=0;for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n]);for(l&&l(t);d.length;)d.shift()()}var n={},s={2:0};function r(t){if(n[t])return n[t].exports;var s=n[t]={i:t,l:!1,exports:{}};return e[t].call(s.exports,s,s.exports,r),s.l=!0,s.exports}r.e=function(e){var t=[],n=s[e];if(0!==n)if(n)t.push(n[2]);else{var a=new Promise(function(t,r){n=s[e]=[t,r]});t.push(n[2]=a);var i,o=document.getElementsByTagName("head")[0],l=document.createElement("script");l.charset="utf-8",l.timeout=120,r.nc&&l.setAttribute("nonce",r.nc),l.src=function(e){return r.p+""+({0:"block-labels",1:"block-prefab-index"}[e]||e)+".js"}(e),i=function(t){l.onerror=l.onload=null,clearTimeout(d);var n=s[e];if(0!==n){if(n){var r=t&&("load"===t.type?"missing":t.type),a=t&&t.target&&t.target.src,i=new Error("Loading chunk "+e+" failed.\n("+r+": "+a+")");i.type=r,i.request=a,n[1](i)}s[e]=void 0}};var d=setTimeout(function(){i({type:"timeout",target:l})},12e4);l.onerror=l.onload=i,o.appendChild(l)}return Promise.all(t)},r.m=e,r.c=n,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)r.d(n,s,function(t){return e[t]}.bind(null,s));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r.oe=function(e){throw console.error(e),e};var a=window.webpackJsonp=window.webpackJsonp||[],i=a.push.bind(a);a.push=t,a=a.slice();for(var o=0;o<a.length;o++)t(a[o]);var l=i;r(r.s=0)}([function(e,t,n){"use strict";async function s(e,t){const n=await async function(e,t){return new Promise((n,s)=>{const r=new e.Image;r.addEventListener("load",()=>n(r)),r.addEventListener("error",s),r.src=t})}(e,t);return e.createImageBitmap(n)}async function r(e,t){if(!t)return null;const n=await async function(e,t){return new Promise((n,s)=>{const r=new e.FileReader;r.onerror=s,r.onload=(()=>n(r.result)),r.readAsDataURL(t)})}(e,t);return s(e,n)}n.r(t);class a{constructor(e,t,s){this.window=e,this.all=[],this.filtered=[],this.prefabsFilterString="",this.blocksFilterString="",this.resultSpan=t,this.listDiv=s,this.markCoords=null,this.blockPrefabIndexPromise=n.e(1).then(n.t.bind(null,2,3)).then(e=>e.default),this.blockLabelsPromise=n.e(0).then(n.t.bind(null,3,3)).then(e=>e.default)}update(){var e;(e=this).markCoords?e.filtered.forEach(t=>{const n=function(e,t){return Math.round(Math.sqrt((e.x-t.x)**2+(e.y-t.y)**2))}(t,e.markCoords);Object.assign(t,{dist:n})}):e.filtered.forEach(e=>{Object.assign(e,{dist:null})}),this.sort(),0===this.all.length?this.resultSpan.textContent="No prefabs":this.filtered.length===this.all.length?this.resultSpan.textContent="All prefabs":this.resultSpan.textContent=`Hit ${this.filtered.length} prefabs`;const t=this.window.document.createElement("ul");this.filtered.forEach(e=>{const n=this.window.document.createElement("li"),s=`<a href="prefabs/${e.name}.html" target="_blank">${e.highlightedName||e.name}</a>`;if(e.dist?n.innerHTML=`${function(e){if(e<1e3)return`${e}m`;return`${(e/1e3).toFixed(2)}km`}(e.dist)}, ${s} (${e.x}, ${e.y})`:n.innerHTML=`${s} (${e.x}, ${e.y})`,e.matchedBlocks&&e.matchedBlocks.length>0){const t=this.window.document.createElement("ul");e.matchedBlocks.forEach(e=>{const n=this.window.document.createElement("li");n.innerHTML=`${e.count}x ${e.highlightedLabel} <small>${e.highlightedName}</small>`,t.appendChild(n)}),n.appendChild(t)}t.appendChild(n)}),this.listDiv.replaceChild(t,this.listDiv.firstChild)}async setPrefabsFilterString(e){if(this.prefabsFilterString=e.trim(),this.blocksFilterString="",this.prefabsFilterString.length<=1)this.filtered=this.all;else{const e=new RegExp(this.prefabsFilterString,"i");this.filtered=this.all.reduce((t,n)=>{const s=o(n.name,e);return s?t.concat(Object.assign({},n,{highlightedName:s})):t},[])}}async setBlocksFilterString(e){if(this.blocksFilterString=e.trim(),this.prefabsFilterString="",e.length<=1)this.filtered=this.all;else{const e=new RegExp(this.blocksFilterString,"i"),[t,n]=await Promise.all([this.blockPrefabIndexPromise,this.blockLabelsPromise]),s=i(e,t,n);if(console.log("%d matched blocks: %o",s.length,s),Object.keys(t).length===i.length)return console.warn("Abort block filter: all blocks are matched: filter=%s",e),void(this.filtered=this.all);const r=s.reduce((e,t)=>(t.prefabs.forEach(n=>{const s=Object.assign({},t,{count:n.count});Object.assign(e,{[n.name]:(e[n.name]||[]).concat(s)})}),e),{});this.filtered=this.all.reduce((e,t)=>{const n=r[t.name];if(!n||0===n.length)return e;const s=Object.assign({},t,{matchedBlocks:n});return e.concat(s)},[])}}async setByFile(e){this.all=await async function(e,t){if(!t)return[];const n=await async function(e,t){return new Promise((n,s)=>{const r=new e.FileReader;r.onerror=s,r.onload=(()=>n(r.result)),r.readAsText(t)})}(e,t);return d(e,n)}(this.window,e),l(this)}async setByUrl(e){this.all=await async function(e,t){if(!t)return[];const n=await e.fetch(t),s=await n.text();return d(e,s)}(this.window,e),l(this)}async setMarkCoords(e){this.markCoords=e}sort(){this.markCoords?this.filtered.sort((e,t)=>e.dist>t.dist?1:e.dist<t.dist?-1:0):this.filtered.sort((e,t)=>e.name>t.name?1:e.name<t.name?-1:0)}}function i(e,t,n){return Object.entries(t).reduce((t,[s,r])=>{const a=o(s,e),i=n[s],l=i&&o(i,e);return a||l?t.concat({name:s,highlightedName:a||s,highlightedLabel:l||i,prefabs:r}):t},[])}function o(e,t){let n=!1;const s=e.replace(t,e=>(n=e.length>0,`<mark>${e}</mark>`));return n?s:null}async function l(e){e.blocksFilterString.length>0?await e.setBlocksFilterString(e.blocksFilterString):await e.setPrefabsFilterString(e.prefabsFilterString)}function d(e,t){const n=(new e.DOMParser).parseFromString(t,"text/xml");return Array.from(n.getElementsByTagName("decoration")).map(e=>{const t=e.getAttribute("position").split(",");return{name:e.getAttribute("name"),x:parseInt(t[0],10),y:parseInt(t[2],10)}})}function c(){const e=document.getElementById("controller"),t=document.getElementById("cood_we"),n=document.getElementById("cood_ns"),i=document.getElementById("download"),o=document.getElementById("reset_flag"),l=document.getElementById("show_biomes"),d=document.getElementById("biomes"),c=document.getElementById("show_splat3"),u=document.getElementById("splat3"),f=document.getElementById("show_radiation"),m=document.getElementById("radiation"),h=document.getElementById("show_prefabs"),g=document.getElementById("prefabs"),p=document.getElementById("scale"),b=document.getElementById("sign_size"),w=document.getElementById("brightness"),y=document.getElementById("prefabs_filter"),v=document.getElementById("prefabs_filter_presets"),E=document.getElementById("blocks_filter"),k=document.getElementById("blocks_filter_presets"),L=document.getElementById("prefabs_num"),B=document.getElementById("prefabs_list"),I=document.getElementById("map"),S=document.getElementById("sample_load"),x=new Worker("map-renderer.js"),F=new a(window,L,B),M=I.transferControlToOffscreen();x.postMessage({canvas:M,showBiomes:l.checked,showSplat3:c.checked,showRad:f.checked,showPrefabs:h.checked,signSize:b.value,brightness:`${w.value}%`,scale:p.value},[M]),d.addEventListener("input",async()=>{console.log("Load biome");const e=await r(window,d.files[0]);e&&x.postMessage({biomesImg:e},[e])}),u.addEventListener("input",async()=>{console.log("Load splat3");const e=await r(window,u.files[0]);e&&x.postMessage({splat3Img:e},[e])}),m.addEventListener("input",async()=>{console.log("Load radiation");const e=await $(window,m.files[0]);e&&x.postMessage({radImg:e},[e])}),g.addEventListener("input",async()=>{console.log("Load prefabs"),await F.setByFile(g.files[0]),x.postMessage({prefabs:F.filtered}),F.update()}),["input","focus"].forEach(e=>{y.addEventListener(e,async()=>{console.log("Update prefab list"),await F.setPrefabsFilterString(y.value),x.postMessage({prefabs:F.filtered}),F.update()}),E.addEventListener(e,async()=>{console.log("Update prefab list"),await F.setBlocksFilterString(E.value),x.postMessage({prefabs:F.filtered}),F.update()})}),[l,c,f,h,b,w,p].forEach(e=>{e.addEventListener("input",()=>{x.postMessage({showBiomes:l.checked,showSplat3:c.checked,showRad:f.checked,showPrefabs:h.checked,signSize:b.value,brightness:`${w.value}%`,scale:p.value})})}),document.addEventListener("drop",async e=>{e.dataTransfer.types.includes("Files")&&(e.preventDefault(),await Promise.all(Array.from(e.dataTransfer.files).map(O)),F.update())}),Array.from(v.getElementsByTagName("button")).forEach(e=>{e.addEventListener("click",()=>{y.value=e.dataset.filter||e.textContent,y.dispatchEvent(new Event("input"))})}),Array.from(k.getElementsByTagName("button")).forEach(e=>{e.addEventListener("click",()=>{E.value=e.dataset.filter||e.textContent,E.dispatchEvent(new Event("input"))})}),I.addEventListener("click",async e=>{const t=D(e);F.setMarkCoords(t),F.update(),x.postMessage({markCoords:t,prefabs:F.filtered})}),o.addEventListener("click",async()=>{F.setMarkCoords(null),F.update(),x.postMessage({markCoords:null,prefabs:F.filtered})}),S.addEventListener("click",()=>{Promise.all([s(window,"sample_world/biomes.png"),s(window,"sample_world/splat3.png"),T(window,"sample_world/radiation.png")]).then(([e,t,n])=>{x.postMessage({biomesImg:e,splat3Img:t,radImg:n},[e,t,n])}),F.setByUrl("sample_world/prefabs.xml").then(()=>{x.postMessage({prefabs:F.filtered}),F.update()})});let C=null,_={width:0,height:0};I.addEventListener("click",e=>{C=e}),o.addEventListener("click",()=>{C=null}),new MutationObserver(t=>{if(!t.find(e=>"width"===e.attributeName))return;if(!t.find(e=>"height"===e.attributeName))return;const n={width:I.width,height:I.height};if(!C)return void(_=n);C={offsetX:C.offsetX*n.width/_.width,offsetY:C.offsetY*n.height/_.height};const s=I.getBoundingClientRect(),r=document.documentElement.getBoundingClientRect(),a=s.left-r.left,i=s.top-r.top,o=C.offsetX+a,l=C.offsetY+i,d={left:o-e.offsetLeft/2,top:l-window.innerHeight/2};window.scrollTo(d),_=n}).observe(I,{attributes:!0}),Array.from(document.querySelectorAll("[data-source-input")).forEach(e=>{const t=document.querySelector(`#${e.dataset.sourceInput}`);e.textContent=t.value,t.addEventListener("input",()=>{e.textContent=t.value})});let P={width:0,height:0};async function O(e){if("biomes.png"===e.name){console.log("Load biome");const t=await r(window,e);x.postMessage({biomesImg:t},[t]),d.value=""}else if("splat3.png"===e.name){console.log("Load splat3");const t=await r(window,e);x.postMessage({splat3Img:t},[t]),u.value=""}else if("radiation.png"===e.name){console.log("Load radiation");const t=await $(window,e);x.postMessage({radImg:t},[t]),m.value=""}else"prefabs.xml"===e.name?(console.log("Update prefab list"),await F.setByFile(e),x.postMessage({prefabs:F.filtered}),g.value=""):console.warn("Unknown file: %s, %s",e.name,e.type)}async function $(e,t){return j(e,await r(e,t))}async function T(e,t){return j(e,await s(e,t))}async function j(e,t){const n=e.document.createElement("canvas");n.width=t.width,n.height=t.height;const s=n.getContext("2d");return s.filter='url("#rad_filter")',s.drawImage(t,0,0),e.createImageBitmap(n)}function D({offsetX:e,offsetY:t}){return{x:-Math.round((.5-e/I.width)*P.width),y:Math.round((.5-t/I.height)*P.height)}}x.addEventListener("message",e=>{e.data.mapSizes&&({mapSizes:P}=e.data)}),I.addEventListener("mousemove",e=>{const{x:s,y:r}=D(e);t.textContent=s,n.textContent=r}),I.addEventListener("mouseout",()=>{t.textContent="-",n.textContent="-"}),i.addEventListener("click",()=>{const e=document.createElement("a");let t;e.href=I.toDataURL("image/png"),0!==F.prefabsFilterString.length?t=F.prefabsFilterString:0!==F.blocksFilterString.length&&(t=F.blocksFilterString);const n=t?`-${t}`:"";e.download=`7DtD-renderer${n}.png`,e.click()}),["input","focus"].forEach(e=>{y.addEventListener(e,()=>{document.body.classList.remove("disable-prefabs-filter"),document.body.classList.add("disable-blocks-filter")}),E.addEventListener(e,()=>{document.body.classList.remove("disable-blocks-filter"),document.body.classList.add("disable-prefabs-filter")})}),document.addEventListener("dragenter",e=>{e.dataTransfer.types.includes("Files")&&(e.preventDefault(),document.body.classList.add("dragovered"))}),document.addEventListener("dragover",e=>{e.dataTransfer.types.includes("Files")&&(e.preventDefault(),e.dataTransfer.dropEffect="copy",document.body.classList.add("dragovered"))}),document.addEventListener("dragleave",e=>{0===e.clientX&&0===e.clientY&&(e.preventDefault(),document.body.classList.remove("dragovered"))}),document.addEventListener("drop",async e=>{e.dataTransfer.types.includes("Files")&&(e.preventDefault(),document.body.classList.remove("dragovered"))}),F.update()}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",c):c()}]);