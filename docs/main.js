!function(e){var t={};function n(a){if(t[a])return t[a].exports;var s=t[a]={i:a,l:!1,exports:{}};return e[a].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=e,n.c=t,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)n.d(a,s,function(t){return e[t]}.bind(null,s));return a},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=127)}({127:function(e,t,n){"use strict";async function a(e,t){const n=await async function(e,t){return new Promise((n,a)=>{const s=new e.Image;s.addEventListener("load",()=>n(s)),s.addEventListener("error",a),s.src=t})}(e,t);return e.createImageBitmap(n)}async function s(e,t){if(!t)return null;const n=await async function(e,t){return new Promise((n,a)=>{const s=new e.FileReader;s.onerror=a,s.onload=(()=>n(s.result)),s.readAsDataURL(t)})}(e,t);return a(e,n)}async function o(e,t){if(!t)return[];const n=await async function(e,t){return new Promise((n,a)=>{const s=new e.FileReader;s.onerror=a,s.onload=(()=>n(s.result)),s.readAsText(t)})}(e,t);return r(e,n)}function r(e,t){const n=(new e.DOMParser).parseFromString(t,"text/xml");return Array.from(n.getElementsByTagName("decoration")).map(e=>{const t=e.getAttribute("position").split(",");return{name:e.getAttribute("name"),x:parseInt(t[0],10),y:parseInt(t[2],10)}})}function d(){const e=document.getElementById("loading_indicator"),t=document.getElementById("controller"),n=document.getElementById("cood_we"),d=document.getElementById("cood_ns"),i=document.getElementById("download"),l=document.getElementById("reset_flag"),c=document.getElementById("show_biomes"),m=document.getElementById("biomes"),u=document.getElementById("show_splat3"),f=document.getElementById("splat3"),p=document.getElementById("show_radiation"),g=document.getElementById("radiation"),h=document.getElementById("show_prefabs"),w=document.getElementById("prefabs"),y=document.getElementById("scale"),b=document.getElementById("sign_size"),v=document.getElementById("brightness"),E=document.getElementById("prefabs_filter"),L=document.getElementById("prefabs_filter_presets"),I=document.getElementById("blocks_filter"),k=document.getElementById("blocks_filter_presets"),B=document.getElementById("prefabs_num"),x=document.getElementById("prefabs_list"),M=document.getElementById("map"),_=document.getElementById("sample_load"),C=new Worker("map-renderer.js"),S=new Worker("prefabs-filter.js"),T=M.transferControlToOffscreen();C.postMessage({canvas:T,showBiomes:c.checked,showSplat3:u.checked,showRad:p.checked,showPrefabs:h.checked,signSize:b.value,brightness:`${v.value}%`,scale:y.value},[T]),(async()=>{const e=await fetch("block-prefab-index.json");S.postMessage({blockPrefabIndex:await e.json()})})(),(async()=>{const e=await fetch("block-labels.json");S.postMessage({blockLabels:await e.json()})})();const $=new Set;async function j(e){if($.add(e.name),"biomes.png"===e.name){const t=await s(window,e);C.postMessage({biomesImg:t},[t]),m.value=""}else if("splat3.png"===e.name){const t=await s(window,e);C.postMessage({splat3Img:t},[t]),f.value=""}else if("radiation.png"===e.name){const t=await z(window,e);C.postMessage({radImg:t},[t]),g.value=""}else if("prefabs.xml"===e.name){const t=await o(window,e);S.postMessage({all:t}),w.value=""}else console.warn("Unknown file: %s, %s",e.name,e.type);$.delete(e.name)}let A,F;m.addEventListener("input",async()=>{console.log("Load biome"),$.add("biomes.png");const e=await s(window,m.files[0]);$.delete("biomes.png"),e&&C.postMessage({biomesImg:e},[e])}),f.addEventListener("input",async()=>{console.log("Load splat3"),$.add("splat3.png");const e=await s(window,f.files[0]);$.delete("splat3.png"),e&&C.postMessage({splat3Img:e},[e])}),g.addEventListener("input",async()=>{console.log("Load radiation"),$.add("radiation.png");const e=await z(window,g.files[0]);$.delete("radiation.png"),e&&C.postMessage({radImg:e},[e])}),w.addEventListener("input",async()=>{console.log("Load prefabs"),$.add("prefabs.xml");const e=await o(window,w.files[0]);$.delete("prefabs.xml"),S.postMessage({all:e})}),["input","focus"].forEach(e=>{E.addEventListener(e,async()=>{console.log("Update prefab list"),S.postMessage({prefabsFilterString:E.value})}),I.addEventListener(e,async()=>{console.log("Update prefab list"),S.postMessage({blocksFilterString:I.value})})}),[c,u,p,h,b,v,y].forEach(e=>{e.addEventListener("input",()=>{C.postMessage({showBiomes:c.checked,showSplat3:u.checked,showRad:p.checked,showPrefabs:h.checked,signSize:b.value,brightness:`${v.value}%`,scale:y.value})})}),S.addEventListener("message",e=>{e.data.prefabs&&C.postMessage({prefabs:e.data.prefabs})}),document.addEventListener("drop",async e=>{e.dataTransfer.types.includes("Files")&&(e.preventDefault(),await Promise.all(Array.from(e.dataTransfer.files).map(j)))}),Array.from(L.getElementsByTagName("button")).forEach(e=>{e.addEventListener("click",()=>{E.value=e.dataset.filter||e.textContent,E.dispatchEvent(new Event("input"))})}),Array.from(k.getElementsByTagName("button")).forEach(e=>{e.addEventListener("click",()=>{I.value=e.dataset.filter||e.textContent,I.dispatchEvent(new Event("input"))})}),M.addEventListener("click",async e=>{const t=U(e);S.postMessage({markCoords:t}),C.postMessage({markCoords:t})}),l.addEventListener("click",async()=>{S.postMessage({markCoords:null}),C.postMessage({markCoords:null})}),_.addEventListener("click",()=>{(async()=>{$.add("biomes.png"),C.postMessage({biomesImg:await a(window,"sample_world/biomes.png")}),$.delete("biomes.png")})(),(async()=>{$.add("splat3.png"),$.add("radiation.png");const[e,t]=await Promise.all([a(window,"sample_world/splat3.png"),H(window,"sample_world/radiation.png")]);C.postMessage({splat3Img:e,radImg:t},[e,t]),$.delete("splat3.png"),$.delete("radiation.png")})(),(async()=>{$.add("prefab.xml");const e=await async function(e,t){if(!t)return[];const n=await e.fetch(t);return r(e,await n.text())}(window,"sample_world/prefabs.xml");$.delete("prefab.xml"),S.postMessage({all:e})})()});const P=10;function D(){if(0===F.length)return;if(t.offsetHeight+t.scrollTop+100<t.scrollHeight)return;const[e,n]=[F.slice(0,P),F.slice(P)],a=document.createDocumentFragment();e.forEach(e=>a.appendChild(function(e){const t=document.createElement("li");if(t.innerHTML=`\n      ${e.dist?`${n=e.dist,n<1e3?`${n}m`:`${(n/1e3).toFixed(2)}km`}, `:""}\n      <a href="prefabs/${e.name}.html" target="_blank">\n        ${e.highlightedName||e.name}\n      </a>\n      (${e.x}, ${e.y})\n    `,e.matchedBlocks&&e.matchedBlocks.length>0){const n=document.createElement("ul");e.matchedBlocks.forEach(e=>{const t=document.createElement("li");t.innerHTML=`${e.count}x ${e.highlightedLabel} <small>${e.highlightedName}</small>`,n.appendChild(t)}),t.appendChild(n)}var n;return t}(e))),A.appendChild(a),F=n,requestAnimationFrame(D)}S.addEventListener("message",e=>{const{prefabs:t,status:n}=e.data;B.innerHTML=n,t&&(A=document.createElement("ul"),F=t,x.replaceChild(A,x.firstChild),requestAnimationFrame(D))}),t.addEventListener("scroll",()=>{D()},{passive:!0});let O=null,R={width:0,height:0};M.addEventListener("click",e=>{O=e}),l.addEventListener("click",()=>{O=null}),new MutationObserver(e=>{if(!e.find(e=>"width"===e.attributeName))return;if(!e.find(e=>"height"===e.attributeName))return;const n={width:M.width,height:M.height};if(!O)return void(R=n);O={offsetX:O.offsetX*n.width/R.width,offsetY:O.offsetY*n.height/R.height};const a=M.getBoundingClientRect(),s=document.documentElement.getBoundingClientRect(),o=a.left-s.left,r=a.top-s.top,d=O.offsetX+o,i=O.offsetY+r,l={left:d-t.offsetLeft/2,top:i-window.innerHeight/2};window.scrollTo(l),R=n}).observe(M,{attributes:!0}),Array.from(document.querySelectorAll("[data-source-input")).forEach(e=>{const t=document.querySelector(`#${e.dataset.sourceInput}`);e.textContent=t.value,t.addEventListener("input",()=>{e.textContent=t.value})});let N={width:0,height:0};async function z(e,t){return q(e,await s(e,t))}async function H(e,t){return q(e,await a(e,t))}async function q(e,t){const n=e.document.createElement("canvas");n.width=t.width,n.height=t.height;const a=n.getContext("2d");return a.filter='url("#rad_filter")',a.drawImage(t,0,0),createImageBitmap(n)}function U({offsetX:e,offsetY:t}){return{x:-Math.round((.5-e/M.width)*N.width),y:Math.round((.5-t/M.height)*N.height)}}C.addEventListener("message",e=>{e.data.mapSizes&&({mapSizes:N}=e.data)}),M.addEventListener("mousemove",e=>{const{x:t,y:a}=U(e);n.textContent=t,d.textContent=a}),M.addEventListener("mouseout",()=>{n.textContent="-",d.textContent="-"}),i.addEventListener("click",()=>{const e=document.createElement("a");e.href=M.toDataURL("image/png"),e.download="7DtD-renderer.png",e.click()}),["input","focus"].forEach(e=>{E.addEventListener(e,()=>{document.body.classList.remove("disable-prefabs-filter"),document.body.classList.add("disable-blocks-filter")}),I.addEventListener(e,()=>{document.body.classList.remove("disable-blocks-filter"),document.body.classList.add("disable-prefabs-filter")})}),document.addEventListener("dragenter",e=>{e.dataTransfer.types.includes("Files")&&(e.preventDefault(),document.body.classList.add("dragovered"))}),document.addEventListener("dragover",e=>{e.dataTransfer.types.includes("Files")&&(e.preventDefault(),e.dataTransfer.dropEffect="copy",document.body.classList.add("dragovered"))}),document.addEventListener("dragleave",e=>{0===e.clientX&&0===e.clientY&&(e.preventDefault(),document.body.classList.remove("dragovered"))}),document.addEventListener("drop",async e=>{e.dataTransfer.types.includes("Files")&&(e.preventDefault(),document.body.classList.remove("dragovered"))}),function t(){0===$.size?e.textContent="-":e.textContent=`Loading: ${Array.from($).join(", ")}`,requestAnimationFrame(t)}()}n.r(t),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",d):d()}});