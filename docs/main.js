!function(e){var t={};function n(a){if(t[a])return t[a].exports;var s=t[a]={i:a,l:!1,exports:{}};return e[a].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=e,n.c=t,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)n.d(a,s,function(t){return e[t]}.bind(null,s));return a},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";async function a(e,t){if(!t)return null;const n=await async function(e,t){return new Promise((n,a)=>{const s=new e.FileReader;s.onerror=a,s.onload=(()=>n(s.result)),s.readAsDataURL(t)})}(e,t),a=await async function(e,t){return new Promise((n,a)=>{const s=new e.Image;s.addEventListener("load",()=>n(s)),s.addEventListener("error",a),s.src=t})}(e,n);return e.createImageBitmap(a)}n.r(t);class s{constructor(e,t,n){this.window=e,this.all=[],this.filtered=[],this.filterString="",this.resultSpan=t,this.listDiv=n}update(){0===this.all.length?this.resultSpan.textContent="No prefabs":0===this.filterString.trim().length?this.resultSpan.textContent="All prefabs":this.resultSpan.textContent=`Hit ${this.filtered.length} prefabs`;const e=this.window.document.createElement("ul");this.filtered.forEach(t=>{const n=this.window.document.createElement("li");n.textContent=`${t.name} (${t.x}, ${t.y})`,e.appendChild(n)}),this.listDiv.replaceChild(e,this.listDiv.firstChild)}setFilterString(e){this.filterString=e,this.filtered=e?this.all.filter(t=>t.name.includes(e)):this.all,this.filtered.sort((e,t)=>e.name>t.name?1:e.name<t.name?-1:0)}async setFile(e){this.all=await async function(e,t){if(!t)return[];const n=await async function(e,t){return new Promise((n,a)=>{const s=new e.FileReader;s.onerror=a,s.onload=(()=>n(s.result)),s.readAsText(t)})}(e,t);if(!n)return[];const a=(new e.DOMParser).parseFromString(n,"text/xml");return Array.from(a.getElementsByTagName("decoration")).map(e=>{const t=e.getAttribute("position").split(",");return{name:e.getAttribute("name"),x:parseInt(t[0],10),y:parseInt(t[2],10)}})}(this.window,e),this.setFilterString(this.filterString)}}function o(){const e=document.getElementById("cood_we"),t=document.getElementById("cood_ns"),n=document.getElementById("download"),o=document.getElementById("show_biomes"),r=document.getElementById("biomes"),i=document.getElementById("show_splat3"),d=document.getElementById("splat3"),l=document.getElementById("show_radiation"),c=document.getElementById("radiation"),u=document.getElementById("show_prefabs"),m=document.getElementById("prefabs"),f=document.getElementById("scale"),p=document.getElementById("sign_size"),g=document.getElementById("brightness"),h=document.getElementById("prefabs_filter"),w=document.getElementById("prefabs_filter_presets"),y=document.getElementById("prefabs_num"),v=document.getElementById("prefabs_list"),b=document.getElementById("map"),E=new Worker("map_renderer.js"),L=b.transferControlToOffscreen();E.postMessage({canvas:L},[L]);const I=new s(window,y,v);r.addEventListener("input",async()=>{console.log("Load biome");const e=await a(window,r.files[0]);e&&E.postMessage({biomesImg:e},[e])}),d.addEventListener("input",async()=>{console.log("Load splat3");const e=await a(window,d.files[0]);e&&E.postMessage({splat3Img:e},[e])}),c.addEventListener("input",async()=>{console.log("Load radiation");const e=await a(window,c.files[0]);e&&E.postMessage({radImg:e},[e])}),m.addEventListener("input",async()=>{console.log("Load prefabs"),await I.setFile(m.files[0]),E.postMessage({prefabs:I.filtered}),I.update()}),h.addEventListener("input",()=>{console.log("Update prefab list"),I.setFilterString(h.value),E.postMessage({prefabs:I.filtered}),I.update()}),E.postMessage({showSplat3:i.checked,showRad:l.checked,showPrefabs:u.checked,signSize:p.value,brightness:`${g.value}%`,scale:f.value}),[o,i,l,u,p,g,f].forEach(e=>{e.addEventListener("input",()=>{E.postMessage({showSplat3:i.checked,showRad:l.checked,showPrefabs:u.checked,signSize:p.value,brightness:`${g.value}%`,scale:f.value})})}),document.addEventListener("dragenter",e=>{e.dataTransfer.types.includes("Files")&&(e.preventDefault(),document.body.classList.add("dragovered"))}),document.addEventListener("dragover",e=>{e.dataTransfer.types.includes("Files")&&(e.preventDefault(),e.dataTransfer.dropEffect="copy",document.body.classList.add("dragovered"))}),document.addEventListener("dragleave",e=>{0===e.clientX&&0===e.clientY&&(e.preventDefault(),document.body.classList.remove("dragovered"))}),document.addEventListener("drop",async e=>{e.dataTransfer.types.includes("Files")&&(e.preventDefault(),document.body.classList.remove("dragovered"),await Promise.all(Array.from(e.dataTransfer.files).map(x)),I.update())}),Array.from(w.getElementsByTagName("button")).forEach(e=>{e.addEventListener("click",()=>{h.value=e.dataset.filter||e.textContent,I.setFilterString(h.value),E.postMessage({prefabs:I.filtered}),I.update()})}),Array.from(document.querySelectorAll("[data-source-input")).forEach(e=>{const t=document.querySelector(`#${e.dataset.sourceInput}`);e.textContent=t.value,t.addEventListener("input",()=>{e.textContent=t.value})});let S={width:0,height:0};async function x(e){if("biomes.png"===e.name){console.log("Load biome");const t=await a(window,e);E.postMessage({biomesImg:t},[t]),r.value=""}else if("splat3.png"===e.name){console.log("Load splat3");const t=await a(window,e);E.postMessage({splat3Img:t},[t]),d.value=""}else if("radiation.png"===e.name){console.log("Load radiation");const t=await async function(e,t){const n=await a(e,t);return async function(e,t){const n=e.document.createElement("canvas");n.width=t.width,n.height=t.height;const a=n.getContext("2d");return a.filter='url("#rad_filter")',a.drawImage(t,0,0),e.createImageBitmap(n)}(e,n)}(window,e);E.postMessage({radImg:t},[t]),c.value=""}else"prefabs.xml"===e.name?(console.log("Update prefab list"),await I.setFile(e),E.postMessage({prefabs:I.filtered}),m.value=""):console.warn("Unknown file: %s, %s",e.name,e.type)}E.addEventListener("message",e=>{e.data.mapSizes&&({mapSizes:S}=e.data)}),b.addEventListener("mousemove",n=>{e.textContent=-Math.round((.5-n.offsetX/b.width)*S.width),t.textContent=Math.round((.5-n.offsetY/b.height)*S.height)}),b.addEventListener("mouseout",()=>{e.textContent="-",t.textContent="-"}),n.addEventListener("click",()=>{const e=document.createElement("a");e.href=b.toDataURL("image/png");const t=h.value?`-${h.value}`:"";e.download=`7DtD-renderer${t}.png`,e.click()}),I.update()}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",o):o()}]);