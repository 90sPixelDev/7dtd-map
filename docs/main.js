!function(e){var t={};function n(a){if(t[a])return t[a].exports;var s=t[a]={i:a,l:!1,exports:{}};return e[a].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=e,n.c=t,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)n.d(a,s,function(t){return e[t]}.bind(null,s));return a},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=127)}({127:function(e,t,n){"use strict";async function a(e,t){const n=await async function(e,t){return new Promise((n,a)=>{const s=new e.Image;s.addEventListener("load",()=>n(s)),s.addEventListener("error",a),s.src=t})}(e,t);return e.createImageBitmap(n)}async function s(e,t){if(!t)return null;const n=await async function(e,t){return new Promise((n,a)=>{const s=new e.FileReader;s.onerror=a,s.onload=(()=>n(s.result)),s.readAsDataURL(t)})}(e,t);return a(e,n)}async function o(e,t){if(!t)return[];const n=await async function(e,t){return new Promise((n,a)=>{const s=new e.FileReader;s.onerror=a,s.onload=(()=>n(s.result)),s.readAsText(t)})}(e,t);return r(e,n)}function r(e,t){const n=(new e.DOMParser).parseFromString(t,"text/xml");return Array.from(n.getElementsByTagName("decoration")).map(e=>{const t=e.getAttribute("position").split(",");return{name:e.getAttribute("name"),x:parseInt(t[0],10),y:parseInt(t[2],10)}})}function d(){const e=document.getElementById("loading_indicator"),t=document.getElementById("controller"),n=document.getElementById("cood_we"),d=document.getElementById("cood_ns"),i=document.getElementById("download"),l=document.getElementById("reset_flag"),c=document.getElementById("show_biomes"),u=document.getElementById("biomes"),m=document.getElementById("show_splat3"),f=document.getElementById("splat3"),p=document.getElementById("show_radiation"),g=document.getElementById("radiation"),h=document.getElementById("show_prefabs"),w=document.getElementById("prefabs"),b=document.getElementById("scale"),y=document.getElementById("sign_size"),v=document.getElementById("brightness"),E=document.getElementById("prefabs_filter"),L=document.getElementById("blocks_filter"),I=document.getElementById("prefabs_num"),k=document.getElementById("prefabs_list"),x=document.getElementById("map"),B=document.getElementById("sample_load"),M=new Worker("map-renderer.js"),_=new Worker("prefabs-filter.js"),C=x.transferControlToOffscreen();M.postMessage({canvas:C,showBiomes:c.checked,showSplat3:m.checked,showRad:p.checked,showPrefabs:h.checked,signSize:y.value,brightness:`${v.value}%`,scale:b.value},[C]),(async()=>{const e=await fetch("block-prefab-index.json");_.postMessage({blockPrefabIndex:await e.json()})})(),(async()=>{const e=await fetch("block-labels.json");_.postMessage({blockLabels:await e.json()})})();const F=new Set;async function S(e){if(F.add(e.name),"biomes.png"===e.name){const t=await s(window,e);M.postMessage({biomesImg:t},[t]),u.value=""}else if("splat3.png"===e.name){const t=await s(window,e);M.postMessage({splat3Img:t},[t]),f.value=""}else if("radiation.png"===e.name){const t=await R(window,e);M.postMessage({radImg:t},[t]),g.value=""}else if("prefabs.xml"===e.name){const t=await o(window,e);_.postMessage({all:t}),w.value=""}else console.warn("Unknown file: %s, %s",e.name,e.type);F.delete(e.name)}let T,j;u.addEventListener("input",async()=>{console.log("Load biome"),F.add("biomes.png");const e=await s(window,u.files[0]);F.delete("biomes.png"),e&&M.postMessage({biomesImg:e},[e])}),f.addEventListener("input",async()=>{console.log("Load splat3"),F.add("splat3.png");const e=await s(window,f.files[0]);F.delete("splat3.png"),e&&M.postMessage({splat3Img:e},[e])}),g.addEventListener("input",async()=>{console.log("Load radiation"),F.add("radiation.png");const e=await R(window,g.files[0]);F.delete("radiation.png"),e&&M.postMessage({radImg:e},[e])}),w.addEventListener("input",async()=>{console.log("Load prefabs"),F.add("prefabs.xml");const e=await o(window,w.files[0]);F.delete("prefabs.xml"),_.postMessage({all:e})}),["input","focus"].forEach(e=>{E.addEventListener(e,async()=>{_.postMessage({prefabsFilterString:E.value})}),L.addEventListener(e,async()=>{_.postMessage({blocksFilterString:L.value})})}),[c,m,p,h,y,v,b].forEach(e=>{e.addEventListener("input",()=>{M.postMessage({showBiomes:c.checked,showSplat3:m.checked,showRad:p.checked,showPrefabs:h.checked,signSize:y.value,brightness:`${v.value}%`,scale:b.value})})}),_.addEventListener("message",e=>{e.data.prefabs&&M.postMessage({prefabs:e.data.prefabs})}),document.addEventListener("drop",async e=>{e.dataTransfer.types.includes("Files")&&(e.preventDefault(),await Promise.all(Array.from(e.dataTransfer.files).map(S)))}),x.addEventListener("click",async e=>{const t=q(e);_.postMessage({markCoords:t}),M.postMessage({markCoords:t})}),l.addEventListener("click",async()=>{_.postMessage({markCoords:null}),M.postMessage({markCoords:null})}),B.addEventListener("click",()=>{(async()=>{F.add("biomes.png"),M.postMessage({biomesImg:await a(window,"sample_world/biomes.png")}),F.delete("biomes.png")})(),(async()=>{F.add("splat3.png"),F.add("radiation.png");const[e,t]=await Promise.all([a(window,"sample_world/splat3.png"),z(window,"sample_world/radiation.png")]);M.postMessage({splat3Img:e,radImg:t},[e,t]),F.delete("splat3.png"),F.delete("radiation.png")})(),(async()=>{F.add("prefab.xml");const e=await async function(e,t){if(!t)return[];const n=await e.fetch(t);return r(e,await n.text())}(window,"sample_world/prefabs.xml");F.delete("prefab.xml"),_.postMessage({all:e})})()});const $=10;function P(){if(0===j.length)return;if(t.offsetHeight+t.scrollTop+100<t.scrollHeight)return;const[e,n]=[j.slice(0,$),j.slice($)],a=document.createDocumentFragment();e.forEach(e=>a.appendChild(function(e){const t=document.createElement("li");if(t.innerHTML=[`<button data-input-for="prefabs_filter" data-input-text="${e.name}" title="Filter with this prefab name">▲</button>`,`${e.dist?`${N(e.dist)},`:""}`,`<a href="prefabs/${e.name}.html" target="_blank">${e.highlightedName||e.name}</a>`,`(${e.x}, ${e.y})`].join(" "),e.matchedBlocks&&e.matchedBlocks.length>0){const n=document.createElement("ul");e.matchedBlocks.forEach(e=>{const t=document.createElement("li");t.innerHTML=[`<button data-input-for="blocks_filter" data-input-text="${e.name}" title="Filter with this block name">▲</button>`,`${e.count}x`,e.highlightedLabel,`<small>${e.highlightedName}</small>`].join(" "),n.appendChild(t)}),t.appendChild(n)}return t}(e))),T.appendChild(a),j=n,requestAnimationFrame(P)}_.addEventListener("message",e=>{const{prefabs:t,status:n}=e.data;I.innerHTML=n,t&&(T=document.createElement("ul"),j=t,k.replaceChild(T,k.firstChild),requestAnimationFrame(P))}),t.addEventListener("scroll",()=>{P()},{passive:!0}),t.addEventListener("click",e=>{const t=e.srcElement;if(null==t.dataset.inputFor)return;const n=document.getElementById(t.dataset.inputFor);n&&(null==t.dataset.inputText?n.value=t.textContent:n.value=t.dataset.inputText,n.dispatchEvent(new Event("input")))});let A=null,D={width:0,height:0};x.addEventListener("click",e=>{A=e}),l.addEventListener("click",()=>{A=null}),new MutationObserver(e=>{if(!e.find(e=>"width"===e.attributeName))return;if(!e.find(e=>"height"===e.attributeName))return;const n={width:x.width,height:x.height};if(!A)return void(D=n);A={offsetX:A.offsetX*n.width/D.width,offsetY:A.offsetY*n.height/D.height};const a=x.getBoundingClientRect(),s=document.documentElement.getBoundingClientRect(),o=a.left-s.left,r=a.top-s.top,d=A.offsetX+o,i=A.offsetY+r,l={left:d-t.offsetLeft/2,top:i-window.innerHeight/2};window.scrollTo(l),D=n}).observe(x,{attributes:!0}),Array.from(document.querySelectorAll("[data-source-input")).forEach(e=>{const t=document.querySelector(`#${e.dataset.sourceInput}`);e.textContent=t.value,t.addEventListener("input",()=>{e.textContent=t.value})});let O={width:0,height:0};async function R(e,t){return H(e,await s(e,t))}async function z(e,t){return H(e,await a(e,t))}async function H(e,t){const n=e.document.createElement("canvas");n.width=t.width,n.height=t.height;const a=n.getContext("2d");return a.filter='url("#rad_filter")',a.drawImage(t,0,0),createImageBitmap(n)}function q({offsetX:e,offsetY:t}){return{x:-Math.round((.5-e/x.width)*O.width),y:Math.round((.5-t/x.height)*O.height)}}function N(e){return e<1e3?`${e}m`:`${(e/1e3).toFixed(2)}km`}M.addEventListener("message",e=>{e.data.mapSizes&&({mapSizes:O}=e.data)}),x.addEventListener("mousemove",e=>{const{x:t,y:a}=q(e);n.textContent=t,d.textContent=a}),x.addEventListener("mouseout",()=>{n.textContent="-",d.textContent="-"}),i.addEventListener("click",()=>{const e=document.createElement("a");e.href=x.toDataURL("image/png"),e.download="7DtD-renderer.png",e.click()}),["input","focus"].forEach(e=>{E.addEventListener(e,()=>{document.body.classList.remove("disable-prefabs-filter"),document.body.classList.add("disable-blocks-filter")}),L.addEventListener(e,()=>{document.body.classList.remove("disable-blocks-filter"),document.body.classList.add("disable-prefabs-filter")})}),document.addEventListener("dragenter",e=>{e.dataTransfer.types.includes("Files")&&(e.preventDefault(),document.body.classList.add("dragovered"))}),document.addEventListener("dragover",e=>{e.dataTransfer.types.includes("Files")&&(e.preventDefault(),e.dataTransfer.dropEffect="copy",document.body.classList.add("dragovered"))}),document.addEventListener("dragleave",e=>{0===e.clientX&&0===e.clientY&&(e.preventDefault(),document.body.classList.remove("dragovered"))}),document.addEventListener("drop",async e=>{e.dataTransfer.types.includes("Files")&&(e.preventDefault(),document.body.classList.remove("dragovered"))}),function t(){0===F.size?e.textContent="-":e.textContent=`Loading: ${Array.from(F).join(", ")}`,requestAnimationFrame(t)}()}n.r(t),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",d):d()}});