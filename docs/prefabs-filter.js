(()=>{"use strict";var t={26:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){let e=null,r=null;return async()=>{e=!0,r||(r=(async()=>{for(;e;)e=!1,await t(),await new Promise((t=>requestAnimationFrame(t)));r=null})())}}},17:function(t,e,r){var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=s(r(26));function n(t,e){return t.name>e.name?1:t.name<e.name?-1:0}function i(t,e){return t.dist&&e.dist?t.dist>e.dist?1:t.dist<e.dist?-1:0:n(t,e)}function l(t,e){const r=t.all.flatMap((t=>{const r=u(t.name,e);return r?{...t,highlightedName:r}:[]}));return t.status=`${r.length} matched prefabs`,r}function o(t,e){const{all:r,blockPrefabIndex:s,blockLabels:a}=t,n=function(t,e,r){return Object.entries(e).reduce(((e,[s,a])=>{const n=u(s,t),i=r[s],l=i&&u(i,t);return n||l?e.concat({name:s,highlightedName:n||s,highlightedLabel:l||i,prefabs:a}):e}),[])}(e,s,a);if(0===n.length)return t.status="No matched blocks",[];const i=function(t){return t.reduce(((t,e)=>{var r;const{name:s,highlightedName:a,highlightedLabel:n}=e;return null===(r=e.prefabs)||void 0===r||r.forEach((e=>{const r={name:s,highlightedName:a,highlightedLabel:n,count:e.count};t[e.name]=(t[e.name]||[]).concat(r)})),t}),{})}(n);if(0===Object.keys(i).length)return t.status=`No prefabs, ${n.length} matched blocks`,[];const l=r.flatMap((t=>{const e=i[t.name];return e?{...t,matchedBlocks:e}:[]}));return t.status=`${l.length} prefabs, ${n.length} matched blocks`,l}function u(t,e){let r=!1;const s=t.replace(e,(t=>(r=t.length>0,`<mark>${t}</mark>`)));return r?s:null}e.default=class{constructor(){this.all=[],this.filtered=[],this.prevFiltered=[],this.filter=null,this.prefabsFilterString="",this.blocksFilterString="",this.markCoords=null,this.prevMarkCoords=null,this.blockPrefabIndex={},this.blockLabels={},this.updateListeners=[],this.status="",this.lazyUpdater=a.default((async()=>this.updateImmediately()))}update(){this.lazyUpdater()}updateImmediately(){var t,e;(t=this).filter?t.filtered=t.filter.func(t,t.filter.pattern):(0===t.all.length?t.status="No prefabs":t.status="All prefabs",t.filtered=t.all),(e=this).markCoords?e.filtered.forEach((t=>{return t.dist=(r=t,s=e.markCoords,Math.round(Math.sqrt((r.x-s.x)**2+(r.z-s.z)**2)));var r,s})):e.filtered.forEach((t=>t.dist=null)),function(t){t.markCoords?t.filtered.sort(i):t.filtered.sort(n)}(this);const r={status:this.status,prefabs:[]};this.prevFiltered===this.filtered&&this.prevMarkCoords===this.markCoords||(r.prefabs=this.filtered,this.prevFiltered=this.filtered,this.prevMarkCoords=this.markCoords),this.updateListeners.forEach((t=>t(r)))}set prefabsFilterString(t){const e=t.trim();0===e.length?this.filter=null:this.filter={name:"prefab name",func:l,pattern:new RegExp(e,"i")}}set blocksFilterString(t){const e=t.trim();0===e.length?this.filter=null:this.filter={name:"block name",func:o,pattern:new RegExp(e,"i")}}addUpdateListener(t){this.updateListeners.push(t)}}},594:function(t,e,r){var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=new(s(r(17)).default);onmessage=({data:t})=>{Object.assign(a,t),a.update()},a.addUpdateListener((t=>postMessage(t)))}},e={};!function r(s){var a=e[s];if(void 0!==a)return a.exports;var n=e[s]={exports:{}};return t[s].call(n.exports,n,n.exports,r),n.exports}(594)})();
//# sourceMappingURL=prefabs-filter.js.map