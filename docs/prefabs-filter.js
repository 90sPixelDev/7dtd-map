(()=>{"use strict";var e={17:function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=r(n(847));function i(e,t){return e.name>t.name?1:e.name<t.name?-1:0}function s(e,t){return e.dist&&t.dist?e.dist>t.dist?1:e.dist<t.dist?-1:0:i(e,t)}function l(e,t){const n=e.all.flatMap((e=>{const n=u(e.name,t);return n?{...e,highlightedName:n}:[]}));return e.status=`${n.length} matched prefabs`,n}function o(e,t){const{all:n,blockPrefabIndex:r,blockLabels:a}=e,i=function(e,t,n){return Object.entries(t).reduce(((t,[r,a])=>{const i=u(r,e),s=n[r],l=s&&u(s,e);return i||l?t.concat({name:r,highlightedName:i||r,highlightedLabel:l||s,prefabs:a}):t}),[])}(t,r,a);if(0===i.length)return e.status="No matched blocks",[];const s=function(e){return e.reduce(((e,t)=>{const{name:n,highlightedName:r,highlightedLabel:a}=t;return t.prefabs?.forEach((t=>{const i={name:n,highlightedName:r,highlightedLabel:a,count:t.count};e[t.name]=(e[t.name]||[]).concat(i)})),e}),{})}(i);if(0===Object.keys(s).length)return e.status=`No prefabs, ${i.length} matched blocks`,[];const l=n.flatMap((e=>{const t=s[e.name];return t?{...e,matchedBlocks:t}:[]}));return e.status=`${l.length} prefabs, ${i.length} matched blocks`,l}function u(e,t){let n=!1;const r=e.replace(t,(e=>(n=e.length>0,`<mark>${e}</mark>`)));return n?r:null}t.default=class{constructor(){this.all=[],this.filtered=[],this.filter=null,this.prefabsFilterString="",this.blocksFilterString="",this.markCoords=null,this.blockPrefabIndex={},this.blockLabels={},this.updateListeners=[],this.status="",this.throttledUpdater=a.default((async()=>this.updateImmediately()))}update(){this.throttledUpdater()}updateImmediately(){var e,t;(e=this).filter?e.filtered=e.filter.func(e,e.filter.pattern):(0===e.all.length?e.status="No prefabs":e.status="All prefabs",e.filtered=e.all),(t=this).markCoords?t.filtered.forEach((e=>{return e.dist=(n=e,r=t.markCoords,Math.round(Math.sqrt((n.x-r.x)**2+(n.z-r.z)**2)));var n,r})):t.filtered.forEach((e=>e.dist=null)),function(e){e.markCoords?e.filtered.sort(s):e.filtered.sort(i)}(this);const n={status:this.status,prefabs:this.filtered};this.updateListeners.forEach((e=>e(n)))}set prefabsFilterString(e){const t=e.trim();0===t.length?this.filter=null:this.filter={name:"prefab name",func:l,pattern:new RegExp(t,"i")}}set blocksFilterString(e){const t=e.trim();0===t.length?this.filter=null:this.filter={name:"block name",func:o,pattern:new RegExp(t,"i")}}addUpdateListener(e){this.updateListeners.push(e)}}},847:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0});const r=n(726);t.default=function(e){let t=null,n=null;return async()=>{t=!0,n||(n=(async()=>{for(;t;)t=!1,await e(),await r.waitAnimationFrame();n=null})())}}},726:(e,t)=>{function n(e,t=(()=>`Unexpected state: ${e}`)){if(e)return e;throw Error(t())}function r(e,t,n=(()=>`Unexpected type: ${e}`)){if(e instanceof t)return e;throw Error(n())}Object.defineProperty(t,"__esModule",{value:!0}),t.waitAnimationFrame=t.humanreadableDistance=t.removeAllChildren=t.component=t.requireType=t.requireNonnull=void 0,t.requireNonnull=n,t.requireType=r,t.component=function(e,t){return r(n(document.getElementById(e)),t)},t.removeAllChildren=function(e){for(;e.lastChild;)e.removeChild(e.lastChild)},t.humanreadableDistance=function(e){return e<1e3?`${e}m`:`${(e/1e3).toFixed(2)}km`},t.waitAnimationFrame=function(){return new Promise((e=>requestAnimationFrame(e)))}},594:function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=new(r(n(17)).default);fetch("block-prefab-index.json").then((async e=>a.blockPrefabIndex=await e.json())),fetch("block-labels.json").then((async e=>a.blockLabels=await e.json())),onmessage=({data:e})=>{Object.assign(a,e).update()},a.addUpdateListener((e=>postMessage(e)))}},t={};!function n(r){var a=t[r];if(void 0!==a)return a.exports;var i=t[r]={exports:{}};return e[r].call(i.exports,i,i.exports,n),i.exports}(594)})();
//# sourceMappingURL=prefabs-filter.js.map