(()=>{"use strict";var t={17:function(t,e,r){var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=n(r(847));function a(t,e){return t.name>e.name?1:t.name<e.name?-1:0}function i(t,e){return t.dist&&e.dist?t.dist>e.dist?1:t.dist<e.dist?-1:0:a(t,e)}function l(t,e){const r=t.all.flatMap((t=>{const r=u(t.name,e);return r?{...t,highlightedName:r}:[]}));return t.status=`${r.length} matched prefabs`,r}function o(t,e){const{all:r,blockPrefabIndex:n,blockLabels:s}=t,a=function(t,e,r){return Object.entries(e).reduce(((e,[n,s])=>{const a=u(n,t),i=r[n],l=i&&u(i,t);return a||l?e.concat({name:n,highlightedName:a||n,highlightedLabel:l||i,prefabs:s}):e}),[])}(e,n,s);if(0===a.length)return t.status="No matched blocks",[];const i=function(t){return t.reduce(((t,e)=>{const{name:r,highlightedName:n,highlightedLabel:s}=e;return e.prefabs?.forEach((e=>{const a={name:r,highlightedName:n,highlightedLabel:s,count:e.count};t[e.name]=(t[e.name]||[]).concat(a)})),t}),{})}(a);if(0===Object.keys(i).length)return t.status=`No prefabs, ${a.length} matched blocks`,[];const l=r.flatMap((t=>{const e=i[t.name];return e?{...t,matchedBlocks:e}:[]}));return t.status=`${l.length} prefabs, ${a.length} matched blocks`,l}function u(t,e){let r=!1;const n=t.replace(e,(t=>(r=t.length>0,`<mark>${t}</mark>`)));return r?n:null}e.default=class{constructor(){this.all=[],this.filtered=[],this.filter=null,this.prefabsFilterString="",this.blocksFilterString="",this.markCoords=null,this.blockPrefabIndex={},this.blockLabels={},this.updateListeners=[],this.status="",this.throttledUpdater=s.default((async()=>this.updateImmediately()))}update(){this.throttledUpdater()}updateImmediately(){var t,e;(t=this).filter?t.filtered=t.filter.func(t,t.filter.pattern):(0===t.all.length?t.status="No prefabs":t.status="All prefabs",t.filtered=t.all),(e=this).markCoords?e.filtered.forEach((t=>{return t.dist=(r=t,n=e.markCoords,Math.round(Math.sqrt((r.x-n.x)**2+(r.z-n.z)**2)));var r,n})):e.filtered.forEach((t=>t.dist=null)),function(t){t.markCoords?t.filtered.sort(i):t.filtered.sort(a)}(this);const r={status:this.status,prefabs:this.filtered};this.updateListeners.forEach((t=>t(r)))}set prefabsFilterString(t){const e=t.trim();0===e.length?this.filter=null:this.filter={name:"prefab name",func:l,pattern:new RegExp(e,"i")}}set blocksFilterString(t){const e=t.trim();0===e.length?this.filter=null:this.filter={name:"block name",func:o,pattern:new RegExp(e,"i")}}addUpdateListener(t){this.updateListeners.push(t)}}},847:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){let e=null,r=null;return async()=>{e=!0,r||(r=(async()=>{for(;e;)e=!1,await t(),await new Promise((t=>requestAnimationFrame(t)));r=null})())}}},594:function(t,e,r){var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=new(n(r(17)).default);onmessage=({data:t})=>{Object.assign(s,t),s.update()},s.addUpdateListener((t=>postMessage(t)))}},e={};!function r(n){var s=e[n];if(void 0!==s)return s.exports;var a=e[n]={exports:{}};return t[n].call(a.exports,a,a.exports,r),a.exports}(594)})();
//# sourceMappingURL=prefabs-filter.js.map