(()=>{"use strict";var t={17:function(t,e,n){var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=r(n(847));function i(t,e){return t.name>e.name?1:t.name<e.name?-1:0}function s(t,e){return t.dist&&e.dist?t.dist>e.dist?1:t.dist<e.dist?-1:0:i(t,e)}function o(t,e){const n=t.all.flatMap((t=>{const n=u(t.name,e);return n?{...t,highlightedName:n}:[]}));return t.status=`${n.length} matched prefabs`,n}function l(t,e){const{all:n,blockPrefabIndex:r,blockLabels:a}=t,i=function(t,e,n){return Object.entries(e).reduce(((e,[r,a])=>{const i=u(r,t),s=n[r],o=s&&u(s,t);return i||o?e.concat({name:r,highlightedName:i||r,highlightedLabel:o||s,prefabs:a}):e}),[])}(e,r,a);if(0===i.length)return t.status="No matched blocks",[];const s=function(t){return t.reduce(((t,e)=>{const{name:n,highlightedName:r,highlightedLabel:a}=e;return e.prefabs?.forEach((e=>{const i={name:n,highlightedName:r,highlightedLabel:a,count:e.count};t[e.name]=(t[e.name]||[]).concat(i)})),t}),{})}(i);if(0===Object.keys(s).length)return t.status=`No prefabs, ${i.length} matched blocks`,[];const o=n.flatMap((t=>{const e=s[t.name];return e?{...t,matchedBlocks:e}:[]}));return t.status=`${o.length} prefabs, ${i.length} matched blocks`,o}function u(t,e){let n=!1;const r=t.replace(e,(t=>(n=t.length>0,`<mark>${t}</mark>`)));return n?r:null}e.default=class{constructor(){this.all=[],this.filtered=[],this.filter=null,this.prefabsFilterString="",this.blocksFilterString="",this.markCoords=null,this.blockPrefabIndex={},this.blockLabels={},this.updateListeners=[],this.status="",this.throttledUpdater=a.default((async()=>this.updateImmediately()))}update(){this.throttledUpdater()}updateImmediately(){var t,e;(t=this).filter?t.filtered=t.filter.func(t,t.filter.pattern):(0===t.all.length?t.status="No prefabs":t.status="All prefabs",t.filtered=t.all),(e=this).markCoords?e.filtered.forEach((t=>{return t.dist=(n=t,r=e.markCoords,Math.round(Math.sqrt((n.x-r.x)**2+(n.z-r.z)**2)));var n,r})):e.filtered.forEach((t=>t.dist=null)),function(t){t.markCoords?t.filtered.sort(s):t.filtered.sort(i)}(this);const n={status:this.status,prefabs:this.filtered};this.updateListeners.forEach((t=>t(n)))}set prefabsFilterString(t){const e=t.trim();0===e.length?this.filter=null:this.filter={name:"prefab name",func:o,pattern:new RegExp(e,"i")}}set blocksFilterString(t){const e=t.trim();0===e.length?this.filter=null:this.filter={name:"block name",func:l,pattern:new RegExp(e,"i")}}addUpdateListener(t){this.updateListeners.push(t)}}},847:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0});const r=n(726);e.default=function(t){let e=!1,n=null;return async()=>{e=!0,n||(n=(async()=>{for(;e;)e=!1,await t(),await r.waitAnimationFrame();n=null})())}}},726:(t,e)=>{function n(t,e=(()=>`Unexpected state: ${t}`)){if(t)return t;throw Error(e())}function r(t,e,n=(()=>`Unexpected type: ${t}`)){if(t instanceof e)return t;throw Error(n())}Object.defineProperty(e,"__esModule",{value:!0}),e.downloadCanvasPng=e.formatCoords=e.waitAnimationFrame=e.humanreadableDistance=e.removeAllChildren=e.component=e.requireType=e.requireNonnull=void 0,e.requireNonnull=n,e.requireType=r,e.component=function(t,e){const a=n(document.getElementById(n(t,(()=>`Element ID must not null: ${t}`))),(()=>`Element not found: #${t}`));return e?r(a,e):a},e.removeAllChildren=function(t){for(;t.lastChild;)t.removeChild(t.lastChild)},e.humanreadableDistance=function(t){return t<1e3?`${t}m`:`${(t/1e3).toFixed(2)}km`},e.waitAnimationFrame=function(){return new Promise((t=>requestAnimationFrame(t)))},e.formatCoords=function(t,e,n,r){if(!r)return"E/W: -, N/S: -, Elev: -";const a=r.offsetX*t.width/e.width,i=r.offsetY*t.height/e.height;return a<0||a>=t.width||i<0||i>=t.height?"E/W: -, N/S: -, Elev: -":`E/W: ${Math.round(a-t.width/2)}, N/S: ${Math.round(t.height/2-i)}, Elev: ${n({x:Math.round(a),z:Math.round(i)},t.width)??"-"}`},e.downloadCanvasPng=function(t,e){const n=document.createElement("a");n.download=t,n.href=e.toDataURL("image/png"),n.click()}},770:function(t,e,n){var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=new(r(n(17)).default);fetch("../block-prefab-index.json").then((async t=>a.blockPrefabIndex=await t.json())),fetch("../block-labels.json").then((async t=>a.blockLabels=await t.json())),onmessage=({data:t})=>{Object.assign(a,t).update()},a.addUpdateListener((t=>postMessage(t)))}},e={};!function n(r){var a=e[r];if(void 0!==a)return a.exports;var i=e[r]={exports:{}};return t[r].call(i.exports,i,i.exports,n),i.exports}(770)})();
//# sourceMappingURL=prefabs-filter.js.map