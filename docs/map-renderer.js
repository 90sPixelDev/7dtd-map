(()=>{"use strict";var t={407:function(t,e,i){var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=s(i(847)),n="🚩️";function h(t,{text:e,x:i,z:s,size:a}){t.lineWidth=Math.round(.2*a),t.strokeStyle="rgba(0, 0, 0, 0.8)",t.strokeText(e,i,s),t.lineWidth=Math.round(.1*a),t.strokeStyle="white",t.strokeText(e,i,s),t.fillText(e,i,s)}e.default=class{constructor(t){this.fontFace=null,this.canvas=t,this.showPrefabs=!0,this.biomesImg=null,this.biomesAlpha=1,this.splat3Img=null,this.splat3Alpha=1,this.splat4Img=null,this.splat4Alpha=1,this.radImg=null,this.radAlpha=1,this.brightness="100%",this.scale=.1,this.signSize=200,this.signAlpha=1,this.prefabs=[],new FontFace("Noto Sans","url(NotoEmoji-Regular.ttf)").load().then((t=>{this.fontFace=t,fonts.add(t)})),this.markerCoords=null,this.throttledUpdater=a.default((()=>this.updateImmediately()))}get width(){return Math.max(this.biomesImg?.width??0,this.splat3Img?.width??0,this.splat4Img?.width??0)}get height(){return Math.max(this.biomesImg?.height??0,this.splat3Img?.height??0,this.splat4Img?.height??0)}async update(){console.time("Map Update"),await this.throttledUpdater(),console.timeEnd("Map Update")}isBlank(){return!this.biomesImg&&!this.splat3Img&&!this.splat4Img}async updateImmediately(){if(this.isBlank())return this.canvas.width=1,void(this.canvas.height=1);this.canvas.width=this.width*this.scale,this.canvas.height=this.height*this.scale;const t=this.canvas.getContext("2d");t&&(t.scale(this.scale,this.scale),t.filter=`brightness(${this.brightness})`,this.biomesImg&&0!==this.biomesAlpha&&(t.globalAlpha=this.biomesAlpha,t.drawImage(this.biomesImg,0,0,this.width,this.height)),this.splat3Img&&0!==this.splat3Alpha&&(t.globalAlpha=this.splat3Alpha,t.drawImage(this.splat3Img,0,0,this.width,this.height)),this.splat4Img&&0!==this.splat4Alpha&&(t.globalAlpha=this.splat4Alpha,t.drawImage(this.splat4Img,0,0,this.width,this.height)),t.filter="none",this.radImg&&0!==this.radAlpha&&(t.globalAlpha=this.radAlpha,t.imageSmoothingEnabled=!1,t.drawImage(this.radImg,0,0,this.width,this.height),t.imageSmoothingEnabled=!0),t.globalAlpha=this.signAlpha,this.showPrefabs&&function(t,e){e.font=`${t.signSize}px ${t.fontFace?.family??""}`,e.fillStyle="red",e.textAlign="center",e.textBaseline="middle";const i=t.width/2,s=t.height/2,a=Math.round(.01*t.signSize),n=Math.round(.05*t.signSize);for(let l=t.prefabs.length-1;l>=0;l-=1){const o=t.prefabs[l];h(e,{text:"✘",x:i+o.x+a,z:s-o.z+n,size:t.signSize})}}(this,t),this.markerCoords&&function(t,e){if(!t.markerCoords)return;e.font=`${t.signSize}px ${t.fontFace?.family??""}`,e.fillStyle="red",e.textAlign="left",e.textBaseline="alphabetic";const i=t.width/2,s=t.height/2,a=-1*Math.round(.32*t.signSize),l=-1*Math.round(.1*t.signSize),o=i+t.markerCoords.x+a,r=s-t.markerCoords.z+l;h(e,{text:n,x:o,z:r,size:t.signSize}),e.strokeText(n,o,r),e.fillText(n,o,r)}(this,t))}}},847:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0});const s=i(726);e.default=function(t){let e=!1,i=null;return async()=>{e=!0,i||(i=(async()=>{for(;e;)e=!1,await t(),await s.waitAnimationFrame();i=null})())}}},726:(t,e)=>{function i(t,e=(()=>`Unexpected state: ${t}`)){if(t)return t;throw Error(e())}function s(t,e,i=(()=>`Unexpected type: ${t}`)){if(t instanceof e)return t;throw Error(i())}Object.defineProperty(e,"__esModule",{value:!0}),e.downloadCanvasPng=e.formatCoords=e.waitAnimationFrame=e.humanreadableDistance=e.removeAllChildren=e.component=e.requireType=e.requireNonnull=void 0,e.requireNonnull=i,e.requireType=s,e.component=function(t,e){const a=i(document.getElementById(i(t,(()=>`Element ID must not null: ${t}`))),(()=>`Element not found: #${t}`));return e?s(a,e):a},e.removeAllChildren=function(t){for(;t.lastChild;)t.removeChild(t.lastChild)},e.humanreadableDistance=function(t){return t<1e3?`${t}m`:`${(t/1e3).toFixed(2)}km`},e.waitAnimationFrame=function(){return new Promise((t=>requestAnimationFrame(t)))},e.formatCoords=function(t,e,i,s){if(!s)return"E/W: -, N/S: -, Elev: -";const a=s.offsetX*t.width/e.width,n=s.offsetY*t.height/e.height;return a<0||a>=t.width||n<0||n>=t.height?"E/W: -, N/S: -, Elev: -":`E/W: ${Math.round(a-t.width/2)}, N/S: ${Math.round(t.height/2-n)}, Elev: ${i({x:Math.round(a),z:Math.round(n)},t.width)??"-"}`},e.downloadCanvasPng=function(t,e){const i=document.createElement("a");i.download=t,i.href=e.toDataURL("image/png"),i.click()}},496:function(t,e,i){var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=s(i(407));let n=null;onmessage=async t=>{const e=t.data;if(!n){if(!e.canvas)throw Error("Unexpected state");n=new a.default(e.canvas)}await Object.assign(n,e).update(),postMessage({mapSize:{width:n.width,height:n.height}})}}},e={};!function i(s){var a=e[s];if(void 0!==a)return a.exports;var n=e[s]={exports:{}};return t[s].call(n.exports,n,n.exports,i),n.exports}(496)})();
//# sourceMappingURL=map-renderer.js.map